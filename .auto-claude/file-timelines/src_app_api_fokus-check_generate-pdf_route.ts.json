{
  "file_path": "src/app/api/fokus-check/generate-pdf/route.ts",
  "main_branch_history": [],
  "task_views": {
    "004-dynamic-import-react-pdf-renderer-to-reduce-client": {
      "task_id": "004-dynamic-import-react-pdf-renderer-to-reduce-client",
      "branch_point": {
        "commit_hash": "8c857a61678b06a3be491f34e522781921073c74",
        "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { renderToBuffer } from '@react-pdf/renderer';\nimport { FokusReportPDF } from '@/components/fokus-check/pdf/FokusReportPDF';\nimport type { Answer, FokusCheckResult } from '@/types/fokus-check';\n\ninterface GeneratePDFRequest {\n  result: FokusCheckResult;\n  answers: Answer[];\n  userName?: string;\n  painPoint?: string;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body: GeneratePDFRequest = await request.json();\n\n    // Validierung\n    if (!body.result || !body.answers) {\n      return NextResponse.json(\n        { error: 'Missing required fields: result and answers' },\n        { status: 400 }\n      );\n    }\n\n    // PDF generieren\n    const pdfBuffer = await renderToBuffer(\n      FokusReportPDF({\n        result: body.result,\n        answers: body.answers.map((a) => ({\n          ...a,\n          answeredAt: new Date(a.answeredAt),\n        })),\n        userName: body.userName,\n        painPoint: body.painPoint,\n        createdAt: new Date(),\n      })\n    );\n\n    // PDF als Response zur\u00fcckgeben (Buffer zu Uint8Array konvertieren)\n    return new NextResponse(new Uint8Array(pdfBuffer), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/pdf',\n        'Content-Disposition': 'attachment; filename=\"fokus-report.pdf\"',\n      },\n    });\n  } catch (error) {\n    console.error('PDF generation error:', error);\n    return NextResponse.json(\n      { error: 'Failed to generate PDF' },\n      { status: 500 }\n    );\n  }\n}\n",
        "timestamp": "2025-12-28T11:56:41.574188"
      },
      "worktree_state": {
        "content": "import { NextRequest, NextResponse } from 'next/server';\nimport type { Answer, FokusCheckResult } from '@/types/fokus-check';\n\ninterface GeneratePDFRequest {\n  result: FokusCheckResult;\n  answers: Answer[];\n  userName?: string;\n  painPoint?: string;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body: GeneratePDFRequest = await request.json();\n\n    // Validierung\n    if (!body.result || !body.answers) {\n      return NextResponse.json(\n        { error: 'Missing required fields: result and answers' },\n        { status: 400 }\n      );\n    }\n\n    // Dynamically import @react-pdf/renderer and FokusReportPDF to avoid client-side bundling\n    const [{ renderToBuffer }, { FokusReportPDF }] = await Promise.all([\n      import('@react-pdf/renderer'),\n      import('@/components/fokus-check/pdf/FokusReportPDF'),\n    ]);\n\n    // PDF generieren\n    const pdfBuffer = await renderToBuffer(\n      FokusReportPDF({\n        result: body.result,\n        answers: body.answers.map((a) => ({\n          ...a,\n          answeredAt: new Date(a.answeredAt),\n        })),\n        userName: body.userName,\n        painPoint: body.painPoint,\n        createdAt: new Date(),\n      })\n    );\n\n    // PDF als Response zur\u00fcckgeben (Buffer zu Uint8Array konvertieren)\n    return new NextResponse(new Uint8Array(pdfBuffer), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/pdf',\n        'Content-Disposition': 'attachment; filename=\"fokus-report.pdf\"',\n      },\n    });\n  } catch (error) {\n    console.error('PDF generation error:', error);\n    return NextResponse.json(\n      { error: 'Failed to generate PDF' },\n      { status: 500 }\n    );\n  }\n}\n",
        "last_modified": "2025-12-28T12:53:04.848775"
      },
      "task_intent": {
        "title": "004-dynamic-import-react-pdf-renderer-to-reduce-client",
        "description": "The @react-pdf/renderer package (~400KB) is currently bundled with client-side code even though it's only used in the server-side API route. Using dynamic imports would ensure this heavy package is only loaded when needed on the server.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-28T11:56:24.861426",
  "last_updated": "2025-12-28T11:56:42.221856"
}